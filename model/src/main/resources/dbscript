create table ACCOUNT(ID integer not null GENERATED ALWAYS AS IDENTITY,
				LOGIN varchar(50) not null,
				PSW varchar(50) not null,
				SURNAME varchar(50) not null,
				NAME varchar(50) not null,
				MIDDLENAME varchar(50) not null,
				ACTIVE boolean not null, primary key (ID));

create table ACCOUNTRIGHTS(ID integer not null GENERATED ALWAYS AS IDENTITY,
				ACCOUNTID integer constraint ACCOUNT_FK references ACCOUNT,
				ACCOUNTROLE smallint not null,
				ACCOUNTROLEACTIVE boolean not null, primary key (ID));

create table FLIGHT(ID integer not null GENERATED ALWAYS AS IDENTITY,
				DATECREATED timestamp not null,
				FLIGHTNUMBER varchar(50) not null,
				DEPARTURE varchar(50) not null,
				ARRIVAL varchar(50) not null,
				DATEDEPARTURE timestamp not null,
				DATEARRIVAL timestamp not null,
				TICKETAMOUNT integer not null,
				TICKETPRICE double not null,
				TICKETFREEAMOUNT integer not null, primary key (ID));
		
create table RESERVATION (ID integer not null GENERATED ALWAYS AS IDENTITY,
				CUSTOMERSURNAME varchar(50) not null,
				CUSTOMERNAME varchar(50) not null,
				CUSTOMERMIDDLENAME varchar(50) not null,
				CUSTOMEREMAIL varchar(50) not null,
				SUMTOTAL double not null,
				DATERESERVATION timestamp not null,
				DATEPAYMENT timestamp,
				PAID boolean not null,
				primary key (ID));
		
create table TICKET(ID integer not null GENERATED ALWAYS AS IDENTITY,
				FLIGHTID integer constraint FLIGHT_FK references FLIGHT,
				STATUS smallint not null,
				RESERVATIONID integer constraint RESERVATION_FK references RESERVATION,
				DATEPAYMENT timestamp, primary key (ID));
				
INSERT INTO FLIGHT (DATECREATED, FLIGHTNUMBER, DEPARTURE, ARRIVAL, DATEDEPARTURE, DATEARRIVAL, TICKETAMOUNT, TICKETPRICE, TICKETFREEAMOUNT)
				VALUES ('2013-12-01 10:00:14', 'PS-711', 'Kyiv', 'Stambul', '2013-12-24 06:40:00', '2013-12-24 08:40:00', 10, 1000, 0);
INSERT INTO FLIGHT (DATECREATED, FLIGHTNUMBER, DEPARTURE, ARRIVAL, DATEDEPARTURE, DATEARRIVAL, TICKETAMOUNT, TICKETPRICE, TICKETFREEAMOUNT)
				VALUES ('2013-12-01 10:20:00', 'AQ-021', 'Kyiv', 'Roma', '2013-12-25 10:20:00', '2013-12-25 12:10:00', 5, 1500, 0);
INSERT INTO FLIGHT (DATECREATED, FLIGHTNUMBER, DEPARTURE, ARRIVAL, DATEDEPARTURE, DATEARRIVAL, TICKETAMOUNT, TICKETPRICE, TICKETFREEAMOUNT)
				VALUES ('2013-12-01 10:30:14', 'TF-140', 'Kyiv', 'New York', '2013-12-28 14:35:00', '2013-12-28 23:55:00', 2, 2000, 0);

INSERT INTO RESERVATION (CUSTOMERSURNAME, CUSTOMERNAME, CUSTOMERMIDDLENAME, CUSTOMEREMAIL, SUMTOTAL, DATERESERVATION, DATEPAYMENT, PAID)
				VALUES ('Surname1', 'Name1', 'Middlename1', 'Address1', 10000.00, '2013-12-04 10:00:14', '2013-12-05 10:00:14', TRUE);
INSERT INTO RESERVATION (CUSTOMERSURNAME, CUSTOMERNAME, CUSTOMERMIDDLENAME, CUSTOMEREMAIL, SUMTOTAL, DATERESERVATION, DATEPAYMENT, PAID)
				VALUES ('Surname2', 'Name2', 'Middlename2', 'Address2', 15000.00, '2013-12-05 10:00:14', '2013-12-06 10:00:14', TRUE);
INSERT INTO RESERVATION (CUSTOMERSURNAME, CUSTOMERNAME, CUSTOMERMIDDLENAME, CUSTOMEREMAIL, SUMTOTAL, DATERESERVATION, DATEPAYMENT, PAID)
				VALUES ('Surname3', 'Name3', 'Middlename3', 'Address3', 20000.00, '2013-12-06 10:00:14', null, FALSE);

INSERT INTO TICKET (FLIGHTID, STATUS, RESERVATIONID, DATEPAYMENT) VALUES (1, 2, 1, '2013-12-05 10:00:14'),
				(1, 2, 1, '2013-12-05 10:00:14'), (1, 1, 3, null), (1, 1, 3, null);
INSERT INTO TICKET (FLIGHTID, STATUS, RESERVATIONID, DATEPAYMENT) VALUES (2, 2, 1, '2013-12-05 10:00:14'),
				(2, 2, 2, '2013-12-06 10:00:14'), (2, 1, 3, null);
INSERT INTO TICKET (FLIGHTID, STATUS, RESERVATIONID, DATEPAYMENT) VALUES (3, 2, 2, '2013-12-06 10:00:14'),
				(3, 2, 2, '2013-12-06 10:00:14');
		
INSERT INTO ACCOUNT (LOGIN, PSW, SURNAME, NAME, MIDDLENAME, ACTIVE) VALUES ('Login1', 'Psw1', 'Surname1', 'Name1', 'Middlename1', TRUE),
				('Login2', 'Psw2', 'Surname2', 'Name2', 'Middlename2', TRUE), ('Login3', 'Psw3', 'Surname3', 'Name3', 'Middlename3', TRUE);

INSERT INTO ACCOUNTRIGHTS (ACCOUNTID, ACCOUNTROLE, ACCOUNTROLEACTIVE) VALUES (1, 0, true), (1, 1, true), (1, 2, false), (2, 0, false), (2, 1, true), (2, 2, false);
		
		
DROP TABLE TICKET;
DROP TABLE RESERVATION;
DROP TABLE FLIGHT;
DROP TABLE ACCOUNTRIGHTS;
DROP TABLE ACCOUNT;

CREATE VIEW SOLDTICKETSBYDAY(TICKETID, TICKETDAYPAYMENT, TICKETPRICE) 
	AS SELECT TICKET.ID, DATE(RESERVATION.DATEPAYMENT), FLIGHT.TICKETPRICE 
	FROM TICKET 
		INNER JOIN FLIGHT ON TICKET.FLIGHTID=FLIGHT.ID
		JOIN RESERVATION ON TICKET.RESERVATIONID=RESERVATION.ID;
SELECT SOLDTICKETSBYDAY.TICKETDAYPAYMENT, count(SOLDTICKETSBYDAY.TICKETID), sum(SOLDTICKETSBYDAY.TICKETPRICE) from SOLDTICKETSBYDAY
GROUP BY SOLDTICKETSBYDAY.TICKETDAYPAYMENT;

SELECT SOLDTICKETSBYDAY.TICKETDAYPAYMENT FROM SOLDTICKETSBYDAY;

DROP VIEW SOLDTICKETSBYDAY;